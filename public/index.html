<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic-Tac-Toe Multiplayer</title>
  <link rel="icon" href="data:,">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      background: #0a0f14;
      color: #d6e3ea;
    }
    .container {
      max-width: 560px;
      margin: 32px auto;
      padding: 20px;
    }
    h1 { color: #d6e3ea; margin-bottom: 1rem; text-align: center; }
    h2 { color: #9ad8d8; margin-bottom: 1.5rem; text-align: center; }
    
    .form-group {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      color: #555;
      font-weight: 600;
    }
    input {
      width: 100%;
      padding: 12px;
      background: #0f1720;
      color: #d6e3ea;
      border: 1px solid #203042;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    input:focus {
      outline: none;
      border-color: #36c2c2;
    }
    
    button {
      width: 100%;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: #17b7b7;
      color: #04121a;
      border: none;
      border-radius: 12px;
      transition: transform 0.2s, box-shadow 0.2s, opacity .2s;
      margin-top: 1rem;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(23,183,183,.25); }
    .cell:active { transform: scale(0.95); }
    
    /* Winning cell style */
    .cell.winning-cell {
      background: rgba(42, 157, 143, 0.3);
      border-color: #2a9d8f;
      box-shadow: 0 0 15px rgba(42, 157, 143, 0.5);
      animation: pulse 1.5s infinite;
    }
    
    /* Clickable cell style */
    .cell.clickable {
      cursor: pointer;
      background: rgba(4, 18, 26, 0.3);
    }
    
    .cell.clickable:hover {
      background: rgba(23, 183, 183, 0.2);
      border-color: #17b7b7;
    }
    
    /* Disabled cell style */
    .cell.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    button:disabled { opacity: .55; cursor: not-allowed; transform: none; box-shadow: none; }
    
    #status {
      margin: 1rem 0;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
    }
    .status-info { background-color: #0f1f2a; color: #89c2ff; }
    .status-success { background-color: #0f2a21; color: #42d392; }
    .status-error { background-color: #2a0f12; color: #ff7b7b; }
    .status-warning { background-color: #2a200f; color: #f6c65b; }
    
    .game-mode-selection {
      margin: 16px 0;
      text-align: center;
    }
    
    .game-mode-selection label {
      display: block;
      margin-bottom: 8px;
      color: #9ad8d8;
      font-weight: 600;
    }
    
    #game-mode {
      padding: 8px 12px;
      background: #0f1720;
      color: #d6e3ea;
      border: 1px solid #203042;
      border-radius: 8px;
      font-size: 14px;
      min-width: 200px;
    }
    
    .timer-display {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin: 12px 0;
      padding: 8px;
      background: #0f1720;
      border-radius: 8px;
      border: 1px solid #203042;
    }
    
    .leaderboard-section {
      margin-top: 24px;
      background: #0f1720;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #203042;
    }
    
    .leaderboard-section h3 {
      color: #9ad8d8;
      margin-bottom: 12px;
      text-align: center;
      font-size: 18px;
    }
    
    .leaderboard-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #1a2332;
      border-radius: 6px;
      color: #d6e3ea;
    }
    
    .leaderboard-item .rank {
      color: #8892a0;
      font-weight: 600;
      min-width: 30px;
    }
    
    .leaderboard-item .username {
      flex: 1;
      margin: 0 8px;
    }
    
    .leaderboard-item .stats {
      color: #8892a0;
      font-size: 12px;
      margin-right: 12px;
    }
    
    .leaderboard-item .score {
      font-weight: bold;
      color: #42d392;
    }
    
    .board-wrap {
      background: #14a7a7;
      border-radius: 20px;
      padding: 22px;
      max-width: 420px;
      margin: 22px auto 10px;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.06), 0 20px 60px rgba(0,0,0,.35);
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .cell {
      aspect-ratio: 1;
      background: rgba(4,18,26,.15);
      border: 3px solid rgba(255,255,255,.6);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3rem;
      font-weight: 900;
      line-height: 1;
      cursor: pointer;
      transition: all 0.3s ease;
      transition: transform .15s ease, background .2s ease;
      border-radius: 12px;
      color: #04232f;
      text-shadow: 0 2px 0 rgba(255,255,255,.35);
    }
    .cell:hover:not(.occupied) { transform: scale(1.03); background: rgba(4,18,26,.22); }
    .cell.occupied { cursor: not-allowed; opacity: .95; }
    .cell.x { color: #04232f; }
    .cell.o { color: #ffffff; }
    
    .hidden { display: none !important; }
    
    .player-info {
      display: flex;
      justify-content: space-between;
      margin: 6px auto 10px;
      padding: 8px 2px;
      max-width: 420px;
      color: #8db4c3;
      font-weight: 700;
    }
    .player { opacity: .85; }
    .active-player { color: #d6ffff; }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.15);
      border-top: 3px solid #17b7b7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Modal + overlay */
    .overlay { position: fixed; inset: 0; background: rgba(3,10,16,.86); display: none; align-items: center; justify-content: center; z-index: 30; }
    .overlay.show { display: flex; }
    .modal { width: 420px; background: #0b131b; border: 1px solid #1a2835; border-radius: 16px; box-shadow: 0 30px 80px rgba(0,0,0,.6); padding: 18px; }
    .modal h3 { color: #9ad8d8; text-align: left; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: .08em; }
    .modal .title { color: #e6f2f6; font-weight: 800; font-size: 18px; margin-bottom: 12px; }
    .modal .actions { display: flex; gap: 8px; margin-top: 12px; }
    .btn-secondary { background: #14202b; color: #c7d7df; }

    /* Result panel */
    .result-card { width: 420px; background: #0b131b; border: 1px solid #1a2835; border-radius: 16px; padding: 18px; text-align: center; }
    .result-title { font-size: 42px; line-height: 1; margin: 6px 0 8px; }
    .winner { color: #a6ffcc; }
    .loser { color: #ff9a9a; }
    .leaderboard { margin-top: 10px; text-align: left; background: #0e1a24; border: 1px solid #1a2835; border-radius: 12px; padding: 12px; }
    .leaderboard h4 { font-size: 13px; color: #8db4c3; margin-bottom: 6px; }
    .lb-row { display: grid; grid-template-columns: 1fr auto; padding: 6px 0; border-top: 1px dashed #213243; }
    .lb-row:first-child { border-top: 0; }
  </style>
</head>
<body>
  <!-- Login Section (kept for status container) -->
  <div id="login-section" class="container hidden">
    <h2>üéÆ Tic-Tac-Toe Multiplayer</h2>
    <div id="login-status"></div>
  </div>

  <!-- Game Section -->
  <div id="game-section" class="container hidden">
    <h1>‚≠ï Tic-Tac-Toe ‚ùå</h1>
    
    <div class="player-info">
      <div class="player">You: <span id="your-name">-</span> (<span id="your-symbol">-</span>)</div>
      <div class="player">Opponent: <span id="opponent-name">-</span> (<span id="opponent-symbol">-</span>)</div>
    </div>
    
    <div id="status" class="status-info">Click "Find Match" to start</div>
    
    <div class="game-mode-selection">
      <label for="game-mode">Game Mode:</label>
      <select id="game-mode">
        <option value="classic">Classic Mode</option>
        <option value="timed">Timed Mode (30s per move)</option>
      </select>
    </div>
    
    <div id="timer" class="timer-display hidden"></div>
    
    <button id="find-match-btn">Find Match</button>
    <button id="cancel-match-btn" class="hidden">Cancel Matchmaking</button>
     <button id="play-bot-btn" class="btn-secondary" style="margin-top:8px">Play vs Bot</button>
    
    <div class="board-wrap hidden" id="board-wrap">
      <div id="game-board"></div>
    </div>
    
    <button id="play-again-btn" class="hidden">Play Again</button>
    
    <div class="leaderboard-section">
      <h3>Leaderboard</h3>
      <div id="leaderboard" class="leaderboard-list"></div>
    </div>
    
    <button id="logout-btn" style="background: #e0e0e0; color: #333; margin-top: 0.5rem;">Logout</button>
  </div>

  <!-- Nickname Modal -->
  <div id="nickname-overlay" class="overlay show">
    <div class="modal">
      <h3>Who are you?</h3>
      <div class="title">Enter a nickname</div>
      <input type="text" id="username" placeholder="Nickname" maxlength="20" autocomplete="off">
      <div class="actions">
        <button id="login-btn">Continue</button>
      </div>
      <div id="login-status" style="margin-top:10px;"></div>
    </div>
  </div>

  <!-- Matchmaking Overlay -->
  <div id="mm-overlay" class="overlay">
    <div class="modal" style="text-align:center">
      <div class="title">Finding a random player...</div>
      <div style="margin:10px 0 2px;">
        <span class="loading"></span>
      </div>
      <div style="opacity:.7; font-size:12px; margin-top:6px;">It usually takes 20 seconds.</div>
      <div class="actions" style="justify-content:center;">
        <button id="mm-cancel" class="btn-secondary" style="max-width:160px;">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Result Overlay -->
  <div id="result-overlay" class="overlay">
    <div class="result-card">
      <div style="font-size:68px; line-height:1">‚úï</div>
      <div class="result-title"><span id="result-text" class="winner">WINNER!</span></div>
      <div class="leaderboard">
        <h4>Leaderboard</h4>
        <div class="lb-row"><div id="lb-me">You</div><div id="lb-me-score">+200</div></div>
        <div class="lb-row"><div id="lb-opp">Opponent</div><div id="lb-opp-score">0</div></div>
      </div>
      <div class="actions" style="justify-content:center;">
        <button id="request-rematch-btn" style="max-width:200px; margin-right: 10px;">Request Rematch</button>
        <button id="result-play-again" style="max-width:200px;">Find New Match</button>
      </div>
    </div>
  </div>

  <!-- Load Nakama JS with a clean authoritative client flow -->
  <script src="/js/nakama-js.umd.min.js"></script>
  <script src="game.js"></script>
</body>
</html>
