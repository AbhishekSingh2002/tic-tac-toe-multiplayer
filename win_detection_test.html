<!DOCTYPE html>
<html>
<head>
    <title>Win Detection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background-color: #d4edda; }
        .fail { background-color: #f8d7da; }
        .board { display: grid; grid-template-columns: repeat(3, 40px); gap: 2px; margin: 10px 0; }
        .cell { width: 40px; height: 40px; border: 1px solid #999; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .winning { background-color: #ffeb3b; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h1>Tic-Tac-Toe Win Detection Test</h1>
    <div id="results"></div>

    <script>
        // Exact copy of the server's check_winner function
        function check_winner(board) {
            // Check rows
            for (let i = 0; i < 9; i += 3) {
                if (board[i] !== "" && board[i] === board[i+1] && board[i] === board[i+2]) {
                    return { winner: board[i], line: [i, i+1, i+2] };
                }
            }
            
            // Check columns
            for (let i = 0; i < 3; i++) {
                if (board[i] !== "" && board[i] === board[i+3] && board[i] === board[i+6]) {
                    return { winner: board[i], line: [i, i+3, i+6] };
                }
            }
            
            // Check diagonals
            if (board[0] !== "" && board[0] === board[4] && board[0] === board[8]) {
                return { winner: board[0], line: [0, 4, 8] };
            }
            if (board[2] !== "" && board[2] === board[4] && board[2] === board[6]) {
                return { winner: board[2], line: [2, 4, 6] };
            }
            
            // Check for draw
            let is_draw = true;
            for (let i = 0; i < 9; i++) {
                if (board[i] === "") {
                    is_draw = false;
                    break;
                }
            }
            
            if (is_draw) {
                return { winner: "draw", line: [] };
            }
            
            return { winner: null, line: [] };
        }

        function renderBoard(board, winningLine = []) {
            const boardDiv = document.createElement('div');
            boardDiv.className = 'board';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = board[i] || 'Â·';
                if (winningLine.includes(i)) {
                    cell.classList.add('winning');
                }
                boardDiv.appendChild(cell);
            }
            
            return boardDiv;
        }

        function runTest(name, board, expectedWinner) {
            const result = check_winner(board);
            const passed = result.winner === expectedWinner;
            
            const testDiv = document.createElement('div');
            testDiv.className = `test ${passed ? 'pass' : 'fail'}`;
            
            testDiv.innerHTML = `
                <strong>${name}:</strong> ${passed ? 'PASS' : 'FAIL'}<br>
                Expected: ${expectedWinner || 'null'}, Got: ${result.winner || 'null'}<br>
                Winning line: [${result.line.join(', ')}]
            `;
            
            testDiv.appendChild(renderBoard(board, result.line));
            
            return testDiv;
        }

        // Run tests
        const resultsDiv = document.getElementById('results');
        
        const tests = [
            {
                name: "Row 1 Win (X)",
                board: ["X", "X", "X", "", "", "", "", "", ""],
                expected: "X"
            },
            {
                name: "Row 2 Win (O)",
                board: ["", "", "", "O", "O", "O", "", "", ""],
                expected: "O"
            },
            {
                name: "Row 3 Win (X)",
                board: ["", "", "", "", "", "", "X", "X", "X"],
                expected: "X"
            },
            {
                name: "Column 1 Win (O)",
                board: ["O", "", "", "O", "", "", "O", "", ""],
                expected: "O"
            },
            {
                name: "Column 2 Win (X)",
                board: ["", "X", "", "", "X", "", "", "X", ""],
                expected: "X"
            },
            {
                name: "Column 3 Win (O)",
                board: ["", "", "O", "", "", "O", "", "", "O"],
                expected: "O"
            },
            {
                name: "Diagonal (Top-Left) Win (X)",
                board: ["X", "", "", "", "X", "", "", "", "X"],
                expected: "X"
            },
            {
                name: "Diagonal (Top-Right) Win (O)",
                board: ["", "", "O", "", "O", "", "O", "", ""],
                expected: "O"
            },
            {
                name: "Draw Game",
                board: ["X", "O", "X", "X", "O", "O", "O", "X", "X"],
                expected: "draw"
            },
            {
                name: "No Winner Yet",
                board: ["X", "O", "X", "", "O", "", "O", "X", ""],
                expected: null
            }
        ];

        tests.forEach(test => {
            resultsDiv.appendChild(runTest(test.name, test.board, test.expected));
        });
    </script>
</body>
</html>